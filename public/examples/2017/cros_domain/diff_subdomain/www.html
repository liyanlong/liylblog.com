<html>
  <head>
    <title>子域跨域解决方案 - 小李子的博客</title>
  </head>
  <body>
    <button id="btn">点击一下</button> 获取<code>m.liylblog.com</code>的资源
    <p>注意: 检查浏览器是否支持 promise</p>
    <div>
      <pre id="console"></pre>
    </div>
  </body>
  <script>
  (function () {
    var getDomainIframe = (function (domain, src) {
      document.domain = domain;
      var ifr = document.createElement('iframe');
      ifr.display = 'none';
      document.domain = ~dotIndex ? document.domain.substr(dotIndex + 1) : document.domain;
      ifr.src = src;
      document.body.appendChild(ifr);
      return new Promise (function (resolve, reject) {
        ifr.onload = function () {
          ifr.onload = null;
          resolve(ifr.contentWindow);
        };
      });
    })('liylblog.com', 'http://m.liylblog.com/public/examples/2017/cros_domain/diff_subdomain/m.html');

    getDomainIframe().then(function (win) {
      console.log(win.document);
      var xhr = new win.XMLHttpRequest();
      getData(xhr, function (data) {
        document.querySelector('#console').innerHTML = data;
      });
    });
    
    function getData (xhr, fn) {
      xhr.open('GET', 'http://m.liylblog.com/public/examples/2017/cros_domain/diff_subdomain/m_data.json', true);
      xhr.onreadystatechange = function () {
        if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
          fn && fn(xhr.responseText);
        }
      }
      xhr.send();
    }
  })();
    
  </script>
</html>